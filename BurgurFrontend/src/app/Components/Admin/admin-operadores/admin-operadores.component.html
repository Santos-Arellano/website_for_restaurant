<!-- Admin Operadores Section -->
<section class="admin-operadores-section">
  <div class="container">
    <!-- Header -->
    <div class="admin-header">
      <h1 class="admin-title">Gestión de Operadores</h1>
      <p class="admin-subtitle">Administra los operadores del sistema</p>

      <!-- Stats -->
      <div class="admin-stats">
        <div class="stat-card">
          <i class="fas fa-headset"></i>
          <div class="stat-info">
            <span class="stat-number">{{ totalOperadores }}</span>
            <span class="stat-label">Total Operadores</span>
          </div>
        </div>
        <div class="stat-card">
          <i class="fas fa-check-circle"></i>
          <div class="stat-info">
            <span class="stat-number">{{ operadoresDisponibles }}</span>
            <span class="stat-label">Disponibles</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Actions -->
    <div class="search-bar">
      <div class="search-input-group">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          placeholder="Buscar operadores por nombre o cédula"
          [(ngModel)]="filtroTexto"
          (input)="filtrarOperadores()"
        />
      </div>
      <div class="filter-controls">
        <button class="btn-add-operador" (click)="abrirModalAgregarOperador()">
          <i class="fas fa-user-plus"></i>
          Agregar Operador
        </button>
        <button class="btn-refresh" (click)="cargarOperadores()">
          <i class="fas fa-sync-alt"></i>
          Actualizar
        </button>
        <button class="btn-refresh" (click)="resetOperadores()" title="Restablecer datos mock">
          <i class="fas fa-undo"></i>
          Reset
        </button>
      </div>
    </div>

    <!-- Operadores Table -->
    <div class="operadores-table" *ngIf="!cargando; else cargandoTpl">
      <div class="table-header">
        <span>NOMBRE</span>
        <span>CÉDULA</span>
        <span>DISPONIBLE</span>
        <span>DOMICILIARIOS</span>
        <span>PEDIDOS</span>
        <span>ACCIONES</span>
      </div>

      <div
        class="table-row"
        *ngFor="let op of operadoresFiltrados; trackBy: trackByOperadorId"
        [attr.data-operador-id]="op.id"
      >
        <div class="cell"><span class="operador-name">{{ op.nombre }}</span></div>
        <div class="cell"><span class="operador-cedula">{{ op.cedula }}</span></div>
        <div class="cell">
          <button class="btn-toggle" [class.active]="op.disponible" (click)="alternarDisponibilidad(op.id)">
            <i class="fas" [class.fa-toggle-on]="op.disponible" [class.fa-toggle-off]="!op.disponible"></i>
          </button>
        </div>
        <div class="cell"><span class="operador-rel">{{ op.domiciliarios.length || 0 }}</span></div>
        <div class="cell"><span class="operador-rel">{{ op.pedidos.length || 0 }}</span></div>
        <div class="cell actions-cell">
          <button class="btn-action btn-edit" (click)="editarOperador(op)">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn-action btn-delete" (click)="abrirDeleteModal(op)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="operadoresFiltrados.length === 0">
        <i class="fas fa-headset"></i>
        <h3>No hay operadores</h3>
        <p>Comienza agregando tu primer operador</p>
        <button class="btn-add-operador" (click)="abrirModalAgregarOperador()">
          <i class="fas fa-user-plus"></i>
          Agregar Operador
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Modal Agregar/Editar Operador -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ modoEdicion ? 'Editar Operador' : 'Agregar Operador' }}</h3>
      <button class="btn-close" (click)="cerrarModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form class="modal-form" (ngSubmit)="guardarOperador()" #operadorForm="ngForm">
      <div class="form-group">
        <label for="nombre">Nombre</label>
        <input
          id="nombre"
          name="nombre"
          type="text"
          [(ngModel)]="operadorSeleccionado.nombre"
          required
          #nombre="ngModel"
          class="form-input"
        />
        <div class="error-message" *ngIf="nombre.invalid && nombre.touched">El nombre es requerido</div>
      </div>

      <div class="form-group">
        <label for="cedula">Cédula</label>
        <input
          id="cedula"
          name="cedula"
          type="text"
          [(ngModel)]="operadorSeleccionado.cedula"
          required
          #cedula="ngModel"
          class="form-input"
        />
        <div class="error-message" *ngIf="cedula.invalid && cedula.touched">La cédula es requerida</div>
      </div>

      <div class="form-group inline">
        <label>Disponible</label>
        <button type="button" class="btn-toggle" [class.active]="operadorSeleccionado.disponible" (click)="operadorSeleccionado.disponible = !operadorSeleccionado.disponible">
          <i class="fas" [class.fa-toggle-on]="operadorSeleccionado.disponible" [class.fa-toggle-off]="!operadorSeleccionado.disponible"></i>
        </button>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
        <button type="submit" class="btn-save" [disabled]="!operadorForm.valid">{{ modoEdicion ? 'Actualizar' : 'Guardar' }}</button>
      </div>
    </form>
  </div>
  
</div>

<!-- Modal Eliminar Operador -->
<div class="modal-overlay" *ngIf="mostrarDeleteModal" (click)="cerrarDeleteModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Eliminar Operador</h3>
      <button class="btn-close" (click)="cerrarDeleteModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>¿Estás seguro de eliminar a <strong>{{ operadorSeleccionado.nombre }}</strong>?</p>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn-cancel" (click)="cerrarDeleteModal()">Cancelar</button>
      <button type="button" class="btn-delete" (click)="eliminarOperador(operadorSeleccionado.id)">Eliminar</button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<ng-template #cargandoTpl>
  <div class="loading-overlay">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Cargando operadores...</p>
    </div>
  </div>
</ng-template>