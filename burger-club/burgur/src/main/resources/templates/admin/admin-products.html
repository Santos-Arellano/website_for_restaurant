<!-- ==========================================
     ARCHIVO: src/main/resources/templates/admin/admin-products.html
     ========================================== -->
     <!DOCTYPE html>
     <html lang="es" xmlns:th="http://www.thymeleaf.org">
     <head>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>Administración - Productos | Burger Club</title>
         
         <!-- Favicon -->
         <link rel="icon" type="image/x-icon" th:href="@{/images/Logo.png}">
         
         <!-- Google Fonts -->
         <link rel="preconnect" href="https://fonts.googleapis.com">
         <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
         <link href="https://fonts.googleapis.com/css2?family=Sansita+Swashed:wght@400;700&family=Lexend+Zetta:wght@400;700&display=swap" rel="stylesheet">
         
         <!-- Font Awesome -->
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
         
         <!-- Main CSS -->
         <link rel="stylesheet" th:href="@{/css/main.css}">
         
         <!-- Estilos embebidos específicos para admin productos -->
         <style>
             :root {
                 --bg-color: #12372a;
                 --text-light: #fbfada;
                 --text-white: #ffffff;
                 --status-nuevo-bg: rgba(255, 20, 20, 0.75);
                 --status-popular-bg: rgba(249, 255, 0, 0.75);
                 --status-activo-bg: rgba(40, 255, 20, 0.75);
                 --color-danger: #f44336;
                 --color-success: #4caf50;
                 --color-info: #2196f3;
                 --border-radius: 8px;
                 --font-primary: 'Sansita Swashed', cursive;
                 --font-secondary: 'Lexend Zetta', sans-serif;
             }
             
             body {
                 background: var(--bg-color);
                 color: var(--text-white);
                 font-family: var(--font-primary);
             }
     
             .admin-products-section {
                 padding: 100px 0 80px 0;
                 min-height: 100vh;
             }
     
             .admin-header {
                 text-align: center;
                 margin-bottom: 50px;
             }
     
             .admin-title {
                 font-family: var(--font-secondary);
                 font-size: clamp(2rem, 5vw, 3rem);
                 color: var(--text-white);
                 margin-bottom: 15px;
                 background: linear-gradient(135deg, var(--text-white) 0%, #fbb5b5 100%);
                 -webkit-background-clip: text;
                 -webkit-text-fill-color: transparent;
                 background-clip: text;
             }
     
             .admin-subtitle {
                 font-size: 1.2rem;
                 color: var(--text-light);
                 opacity: 0.8;
             }
     
             .admin-stats {
                 display: grid;
                 grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                 gap: 20px;
                 margin: 30px 0;
             }
     
             .stat-card {
                 background: rgba(255, 255, 255, 0.1);
                 padding: 20px;
                 border-radius: var(--border-radius);
                 display: flex;
                 align-items: center;
                 gap: 15px;
                 backdrop-filter: blur(10px);
                 border: 1px solid rgba(255, 255, 255, 0.2);
                 transition: all 0.3s ease;
             }
     
             .stat-card:hover {
                 transform: translateY(-3px);
                 background: rgba(255, 255, 255, 0.15);
             }
     
             .stat-card i {
                 font-size: 2rem;
                 color: #fbb5b5;
             }
     
             .stat-info {
                 display: flex;
                 flex-direction: column;
             }
     
             .stat-number {
                 font-size: 1.8rem;
                 font-weight: 700;
                 color: var(--text-white);
             }
     
             .stat-label {
                 font-size: 0.9rem;
                 color: var(--text-light);
                 opacity: 0.8;
             }
     
             .search-bar {
                 background: rgba(217, 217, 217, 0.1);
                 border-radius: var(--border-radius);
                 padding: 20px 25px;
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 margin-bottom: 40px;
                 backdrop-filter: blur(10px);
                 border: 1px solid rgba(255, 255, 255, 0.1);
                 flex-wrap: wrap;
                 gap: 15px;
             }
     
             .search-input-group {
                 display: flex;
                 align-items: center;
                 gap: 15px;
                 flex: 1;
                 max-width: 400px;
             }
     
             .search-icon {
                 color: rgba(255, 255, 255, 0.4);
                 font-size: 1.2rem;
             }
     
             .search-input {
                 flex: 1;
                 background: transparent;
                 border: none;
                 color: var(--text-white);
                 font-family: var(--font-primary);
                 font-size: 16px;
                 outline: none;
             }
     
             .search-input::placeholder {
                 color: rgba(255, 255, 255, 0.4);
             }
     
             .filter-controls {
                 display: flex;
                 align-items: center;
                 gap: 20px;
             }
     
             .filter-select {
                 background: rgba(255, 255, 255, 0.1);
                 border: 1px solid rgba(255, 255, 255, 0.2);
                 color: var(--text-white);
                 padding: 8px 15px;
                 border-radius: var(--border-radius);
                 font-family: var(--font-primary);
                 cursor: pointer;
             }
     
             .filter-select option {
                 background: var(--bg-color);
                 color: var(--text-white);
             }
     
             .btn-add-product {
                 background: var(--status-activo-bg);
                 color: var(--text-white);
                 border: none;
                 padding: 12px 20px;
                 border-radius: var(--border-radius);
                 font-family: var(--font-primary);
                 font-weight: 600;
                 cursor: pointer;
                 display: flex;
                 align-items: center;
                 gap: 8px;
                 transition: all 0.3s ease;
             }
     
             .btn-add-product:hover {
                 background: #2d7a2f;
                 transform: translateY(-2px);
             }
     
             .product-table {
                 background: rgba(255, 255, 255, 0.02);
                 border-radius: var(--border-radius);
                 padding: 20px;
                 backdrop-filter: blur(5px);
             }
     
             .table-header,
             .table-row {
                 display: grid;
                 grid-template-columns: 12% 20% 18% 15% 15% 12% 8%;
                 align-items: center;
                 text-align: center;
                 gap: 10px;
                 min-height: 60px;
             }
     
             .table-header {
                 font-family: var(--font-secondary);
                 font-weight: 700;
                 font-size: 12px;
                 color: var(--text-white);
                 padding: 0 15px 25px 15px;
                 text-transform: uppercase;
                 letter-spacing: 1px;
                 border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                 margin-bottom: 20px;
             }
     
             .table-row {
                 background: linear-gradient(180deg, #09342f 0%, rgba(58, 89, 78, 0) 100%);
                 border: 2px solid #0e3b36;
                 border-radius: var(--border-radius);
                 min-height: 80px;
                 margin-bottom: 15px;
                 padding: 10px 15px;
                 transition: all 0.3s ease;
             }
     
             .table-row:hover {
                 transform: translateY(-3px);
                 box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
                 border-color: #1a5a52;
             }
     
             .table-row .cell {
                 font-family: var(--font-secondary);
                 font-weight: 600;
                 font-size: 12px;
                 color: var(--text-white);
                 display: flex;
                 justify-content: center;
                 align-items: center;
             }
     
             .product-img {
                 max-width: 70px;
                 max-height: 50px;
                 object-fit: cover;
                 border-radius: var(--border-radius);
                 box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
             }
     
             .product-name {
                 font-size: 14px;
                 font-weight: 700;
                 color: var(--text-white);
             }
     
             .product-category {
                 text-transform: uppercase;
                 font-size: 11px;
                 opacity: 0.8;
                 color: #fbb5b5;
             }
     
             .product-price {
                 font-size: 16px;
                 font-weight: 700;
                 color: #fbb5b5;
             }
     
             .status {
                 padding: 6px 14px;
                 border-radius: 20px;
                 font-family: var(--font-secondary);
                 font-weight: 700;
                 font-size: 9px;
                 color: var(--text-white);
                 text-transform: uppercase;
                 letter-spacing: 0.5px;
             }
     
             .status--nuevo { 
                 background: var(--status-nuevo-bg);
             }
     
             .status--popular { 
                 background: var(--status-popular-bg);
                 color: #333;
             }
     
             .status--activo { 
                 background: var(--status-activo-bg);
             }
     
             .stock-count {
                 font-size: 16px;
                 font-weight: 700;
                 padding: 4px 8px;
                 border-radius: var(--border-radius);
             }
     
             .stock-low {
                 color: var(--color-danger);
                 background: rgba(244, 67, 54, 0.2);
             }
     
             .stock-medium {
                 color: #ff9800;
                 background: rgba(255, 152, 0, 0.2);
             }
     
             .stock-high {
                 color: var(--color-success);
                 background: rgba(76, 175, 80, 0.2);
             }
     
             .actions-cell {
                 display: flex;
                 justify-content: center;
                 align-items: center;
                 gap: 8px;
             }
     
             .btn-action {
                 width: 36px;
                 height: 36px;
                 border: none;
                 border-radius: 6px;
                 cursor: pointer;
                 display: flex;
                 align-items: center;
                 justify-content: center;
                 transition: all 0.3s ease;
                 font-size: 14px;
             }
     
             .btn-edit {
                 background: var(--color-info);
                 color: white;
             }
     
             .btn-edit:hover {
                 background: #1976d2;
                 transform: translateY(-2px) scale(1.05);
             }
     
             .btn-delete {
                 background: var(--color-danger);
                 color: white;
             }
     
             .btn-delete:hover {
                 background: #d32f2f;
                 transform: translateY(-2px) scale(1.05);
             }
     
             .empty-state {
                 text-align: center;
                 padding: 60px 20px;
                 color: var(--text-light);
                 opacity: 0.7;
                 grid-column: 1 / -1;
             }
     
             .empty-state i {
                 font-size: 4rem;
                 margin-bottom: 20px;
                 opacity: 0.5;
             }
     
             .empty-state h3 {
                 font-size: 1.5rem;
                 margin-bottom: 10px;
                 color: var(--text-white);
             }
     
             .btn-load-more {
                 display: inline-flex;
                 align-items: center;
                 gap: 8px;
                 background: var(--color-info);
                 color: white;
                 padding: 10px 20px;
                 border-radius: var(--border-radius);
                 text-decoration: none;
                 margin-top: 20px;
                 transition: all 0.3s ease;
             }
     
             .btn-load-more:hover {
                 background: #1976d2;
                 text-decoration: none;
                 color: white;
                 transform: translateY(-2px);
             }
     
             @media (max-width: 768px) {
                 .admin-products-section {
                     padding: 80px 0 60px 0;
                 }
     
                 .search-bar {
                     flex-direction: column;
                     align-items: stretch;
                 }
     
                 .filter-controls {
                     justify-content: space-between;
                     flex-wrap: wrap;
                 }
     
                 .table-header {
                     display: none;
                 }
     
                 .table-row {
                     grid-template-columns: 1fr 1fr;
                     gap: 15px;
                     text-align: left;
                     padding: 15px;
                 }
     
                 .table-row .cell {
                     justify-content: flex-start;
                 }
     
                 .table-row .cell:nth-child(1) {
                     grid-column: 1 / 2;
                     grid-row: 1 / 3;
                     justify-content: center;
                 }
     
                 .table-row .cell:nth-child(2) {
                     grid-column: 2 / 3;
                     grid-row: 1 / 2;
                     font-size: 16px;
                     font-weight: bold;
                 }
     
                 .table-row .cell:nth-child(4) {
                     grid-column: 2 / 3;
                     grid-row: 2 / 3;
                     font-size: 18px;
                 }
     
                 .table-row .cell:nth-child(5) {
                     grid-column: 1 / 2;
                     grid-row: 3 / 4;
                     justify-content: center;
                 }
     
                 .table-row .cell:nth-child(7) {
                     grid-column: 2 / 3;
                     grid-row: 3 / 4;
                     justify-content: flex-end;
                 }
     
                 .table-row .cell:nth-child(3),
                 .table-row .cell:nth-child(6) {
                     display: none;
                 }
             }
         </style>
     </head>
     <body>
         <!-- Header básico -->
         <header class="site-header">
             <div class="container header-container">
                 <a th:href="@{/}" class="logo">
                     <div class="logo-icon-wrapper">
                         <img th:src="@{/images/Logo.png}" alt="Burger Club Logo" class="logo-icon">
                     </div>
                     <span class="logo-text">BURGER CLUB</span>
                 </a>
     
                 <nav class="main-nav">
                     <ul>
                         <li><a th:href="@{/}">Inicio</a></li>
                         <li><a th:href="@{/menu}">Menú</a></li>
                         <li><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                         <li><a th:href="@{/menu/admin}" class="admin-nav">Productos</a></li>
                         <li><a th:href="@{/admin/adicionales}">Adicionales</a></li>
                         <li><a th:href="@{/admin/clientes}">Clientes</a></li>
                     </ul>
                 </nav>
             </div>
         </header>
     
         <!-- Admin Products Section -->
         <main class="admin-products-section">
             <div class="container">
                 <!-- Admin Header -->
                 <div class="admin-header">
                     <h1 class="admin-title">Gestión de Productos</h1>
                     <p class="admin-subtitle">Administra el menú de Burger Club</p>
                 </div>
     
                 <!-- Stats Cards -->
                 <div class="admin-stats" th:if="${totalProductos != null}">
                     <div class="stat-card">
                         <i class="fas fa-box"></i>
                         <div class="stat-info">
                             <div class="stat-number" th:text="${totalProductos}">0</div>
                             <div class="stat-label">Total Productos</div>
                         </div>
                     </div>
                     <div class="stat-card">
                         <i class="fas fa-star"></i>
                         <div class="stat-info">
                             <div class="stat-number" th:text="${productosNuevos}">0</div>
                             <div class="stat-label">Productos Nuevos</div>
                         </div>
                     </div>
                     <div class="stat-card">
                         <i class="fas fa-fire"></i>
                         <div class="stat-info">
                             <div class="stat-number" th:text="${productosActivos}">0</div>
                             <div class="stat-label">Activos</div>
                         </div>
                     </div>
                     <div class="stat-card" th:if="${stockBajo > 0}">
                         <i class="fas fa-exclamation-triangle"></i>
                         <div class="stat-info">
                             <div class="stat-number" th:text="${stockBajo}">0</div>
                             <div class="stat-label">Stock Bajo</div>
                         </div>
                     </div>
                 </div>
     
                 <!-- Search and Filter Bar -->
                 <div class="search-bar">
                     <div class="search-input-group">
                         <i class="fas fa-search search-icon"></i>
                         <input type="text" class="search-input" placeholder="Buscar productos..." id="adminSearchInput">
                     </div>
                     <div class="filter-controls">
                         <select class="filter-select" id="categoryFilter">
                             <option value="TODOS">TODOS</option>
                             <option value="hamburguesa">HAMBURGUESAS</option>
                             <option value="acompañamiento">ACOMPAÑAMIENTOS</option>
                             <option value="perro caliente">PERROS CALIENTES</option>
                             <option value="bebida">BEBIDAS</option>
                             <option value="postre">POSTRES</option>
                         </select>
                         <button class="btn-add-product" type="button" onclick="openAddProductModal()">
                             <i class="fas fa-plus"></i>
                             Agregar Producto
                         </button>
                         
                     </div>
                 </div>
     
                 <!-- Product Table -->
                 <div class="product-table">
                     <div class="table-header">
                         <span>IMAGEN</span>
                         <span>PRODUCTO</span>
                         <span>CATEGORÍA</span>
                         <span>PRECIO</span>
                         <span>ESTADO</span>
                         <span>STOCK</span>
                         <span>ACCIONES</span>
                     </div>
     
                     <!-- Mensaje si no hay productos -->
                     <th:block th:if="${#lists.isEmpty(productos)}">
                         <div class="empty-state">
                             <i class="fas fa-search"></i>
                             <h3>No se encontraron productos</h3>
                             <p>Actualmente no hay productos disponibles.</p>
                             <a href="#" class="btn-load-more" onclick="openAddProductModal()">
                                 <span>Agregar primer producto</span>
                                 <i class="fas fa-plus"></i>
                             </a>
                         </div>
                     </th:block>
     
                     <!-- Loop de productos -->
                     <div class="table-row" th:each="producto : ${productos}"
                          th:attr="data-product-id=${producto.id}">
                         
                         <div class="cell">
                             <img th:src="${producto.imgURL}" 
                                  th:alt="${producto.nombre}" 
                                  class="product-img"
                                  onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2270%22 height=%2250%22%3E%3Crect width=%2270%22 height=%2250%22 fill=%22%234ecdc4%22/%3E%3Ctext x=%2235%22 y=%2230%22 font-size=%2220%22 text-anchor=%22middle%22%3E🍔%3C/text%3E%3C/svg%3E'">
                         </div>
     
                         <div class="cell">
                             <div class="product-name" th:text="${producto.nombre}">Producto</div>
                         </div>
     
                         <div class="cell">
                             <div class="product-category" th:text="${#strings.toUpperCase(producto.categoria)}">Categoría</div>
                         </div>
     
                         <div class="cell">
                             <div class="product-price" th:text="'$' + ${#numbers.formatInteger(producto.precio, 0, 'COMMA')}">$0</div>
                         </div>
     
                         <div class="cell">
                             <span th:if="${producto.nuevo}" class="status status--nuevo">NUEVO</span>
                             <span th:if="${producto.popular and !producto.nuevo}" class="status status--popular">POPULAR</span>
                             <span th:if="${!producto.nuevo and !producto.popular}" class="status status--activo">ACTIVO</span>
                         </div>
     
                         <div class="cell">
                             <span class="stock-count" 
                                   th:classappend="${producto.stock < 5} ? 'stock-low' : (${producto.stock < 15} ? 'stock-medium' : 'stock-high')"
                                   th:text="${producto.stock}">0</span>
                         </div>
     
                         <div class="cell actions-cell">
                             <button class="btn-action btn-edit" 
                                     type="button"
                                     th:onclick="'editProduct(' + ${producto.id} + ')'"
                                     title="Editar producto">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="btn-action btn-delete" 
                                     type="button"
                                     th:onclick="'deleteProduct(' + ${producto.id} + ')'"
                                     title="Eliminar producto">
                                 <i class="fas fa-trash"></i>
                             </button>
                         </div>
                     </div>
                 </div>
             </div>
         </main>
     
         <!-- Footer -->
         <footer class="site-footer">
             <div class="container">
                 <div class="footer-social">
                     <h3>Panel de Administración</h3>
                     <div class="social-links">
                         <a href="#" class="social-link"><i class="fas fa-home"></i><span>Inicio</span></a>
                         <a th:href="@{/admin/dashboard}" class="social-link"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
                         <a href="#" class="social-link" onclick="updateAllAdicionales()"><i class="fas fa-sync-alt"></i><span>Actualizar</span></a>
                     </div>
                 </div>
                 <div class="footer-bottom">
                     <p>&copy; 2024 Burger Club. Todos los derechos reservados.</p>
                 </div>
             </div>
         </footer>
     
         <!-- JavaScript Files -->
         <script type="module" th:src="@{/js/app.js}" defer></script>
         
         <!-- Scripts de administración -->
         <script th:src="@{/js/admin-universal.js}"></script>
         <script type="module" th:src="@{/js/admin/admin-modal-manager.js}" defer></script>
     
         <script>
             // Inicialización específica para productos
             document.addEventListener('DOMContentLoaded', function() {
                 console.log('Admin Products page loaded');
                 
                 // Funcionalidad mejorada para mostrar adicionales de un producto
                 const productRows = document.querySelectorAll('.table-row[data-product-id]');
                 productRows.forEach(row => {
                     // Tooltip para indicar que se puede hacer doble click
                     row.title = 'Doble click para ver adicionales disponibles';
                     
                     row.addEventListener('dblclick', function() {
                         const productId = this.getAttribute('data-product-id');
                         if (productId) {
                             showProductAdicionales(productId);
                         }
                     });
                 });
             });
     
             // Función para mostrar adicionales de un producto
             async function showProductAdicionales(productId) {
                 try {
                     const response = await fetch(`/menu/api/productos/${productId}`);
                     if (response.ok) {
                         const data = await response.json();
                         const producto = data.producto || data;
                         const adicionales = data.adicionalesPermitidos || [];
                         
                         let adicionalesHtml = '';
                         if (adicionales.length > 0) {
                             adicionalesHtml = adicionales.map(a => `
                                 <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); border-radius: 4px; margin-bottom: 5px; background: rgba(255,255,255,0.05);">
                                     <span style="font-weight: 600;">${a.nombre}</span>
                                     <span style="color: #fbb5b5; font-weight: 700;">$${a.precio.toLocaleString()}</span>
                                 </div>
                             `).join('');
                         } else {
                             adicionalesHtml = '<div style="text-align: center; padding: 30px; color: rgba(255,255,255,0.6);"><i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>No hay adicionales disponibles para este producto</div>';
                         }
     
                         // Crear modal personalizado para mostrar adicionales
                         const modal = document.createElement('div');
                         modal.className = 'admin-modal adicionales-preview-modal active';
                         modal.innerHTML = `
                             <div class="modal-content">
                                 <div class="modal-header">
                                     <h3><i class="fas fa-plus-circle"></i> Adicionales: ${producto.nombre}</h3>
                                     <button class="modal-close" type="button">&times;</button>
                                 </div>
                                 <div class="modal-body">
                                     <div style="margin-bottom: 20px; padding: 15px; background: rgba(251, 181, 181, 0.1); border-radius: 6px; border-left: 4px solid #fbb5b5;">
                                         <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                             <strong>Categoría:</strong> 
                                             <span style="text-transform: capitalize; color: #fbb5b5;">${producto.categoria}</span>
                                         </div>
                                         <div style="display: flex; justify-content: space-between;">
                                             <strong>Precio base:</strong> 
                                             <span style="color: #fbb5b5;">$${producto.precio.toLocaleString()}</span>
                                         </div>
                                     </div>
                                     <div style="max-height: 300px; overflow-y: auto;">
                                         <h4 style="margin-bottom: 15px; color: #fbb5b5;"><i class="fas fa-list"></i> Adicionales Disponibles (${adicionales.length})</h4>
                                         ${adicionalesHtml}
                                     </div>
                                     ${adicionales.length > 0 ? `
                                         <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 6px; border-left: 4px solid #4caf50; text-align: center;">
                                             <small style="color: rgba(255,255,255,0.8);">
                                                 <i class="fas fa-info-circle"></i> 
                                                 Los adicionales se asignan automáticamente según la categoría del producto
                                             </small>
                                         </div>
                                     ` : ''}
                                 </div>
                             </div>
                         `;
     
                         document.body.appendChild(modal);
                         
                         // Cerrar modal
                         const closeModal = () => {
                             modal.classList.remove('active');
                             setTimeout(() => {
                                 if (document.body.contains(modal)) {
                                     document.body.removeChild(modal);
                                 }
                             }, 300);
                         };
     
                         modal.querySelector('.modal-close').addEventListener('click', closeModal);
                         modal.addEventListener('click', (e) => {
                             if (e.target === modal) {
                                 closeModal();
                             }
                         });
     
                         // Cerrar con ESC
                         const escHandler = (e) => {
                             if (e.key === 'Escape') {
                                 closeModal();
                                 document.removeEventListener('keydown', escHandler);
                             }
                         };
                         document.addEventListener('keydown', escHandler);
     
                     } else {
                         alert('Error al cargar la información del producto');
                     }
                 } catch (error) {
                     console.error('Error:', error);
                     alert('Error al cargar los adicionales');
                 }
             }
     
             // Función para actualizar todas las relaciones de adicionales
             async function updateAllAdicionales() {
                 if (!confirm('¿Deseas actualizar las relaciones de adicionales para todos los productos?\n\nEsto vinculará automáticamente los adicionales según las categorías.')) {
                     return;
                 }
     
                 try {
                     const response = await fetch('/admin/api/update-adicionales', {
                         method: 'POST'
                     });
                     
                     const result = await response.json();
                     
                     if (result.success) {
                         alert(`Éxito: ${result.message}\nAdicionales actualizados: ${result.count}`);
                     } else {
                         alert(`Error: ${result.message}`);
                     }
                 } catch (error) {
                     console.error('Error:', error);
                     alert('Error al actualizar adicionales');
                 }
             }
     
             // Función para reconstruir todas las relaciones (elimina todas y las crea de nuevo)
             async function rebuildAllAdicionales() {
                 if (!confirm('¿Deseas RECONSTRUIR completamente las relaciones de adicionales?\n\n⚠️ ADVERTENCIA: Esto eliminará todas las relaciones actuales y las creará nuevamente según las categorías.\n\n¿Estás seguro?')) {
                     return;
                 }
     
                 try {
                     const response = await fetch('/admin/api/rebuild-adicionales', {
                         method: 'POST'
                     });
                     
                     const result = await response.json();
                     
                     if (result.success) {
                         alert(`Éxito: ${result.message}\nRelaciones reconstruidas: ${result.count}`);
                     } else {
                         alert(`Error: ${result.message}`);
                     }
                 } catch (error) {
                     console.error('Error:', error);
                     alert('Error al reconstruir adicionales');
                 }
             }
     
             // Animación de entrada para las filas
             function animateTableRows() {
                 const rows = document.querySelectorAll('.table-row[data-product-id]');
                 rows.forEach((row, index) => {
                     row.style.opacity = '0';
                     row.style.transform = 'translateY(20px)';
                     
                     setTimeout(() => {
                         row.style.transition = 'all 0.6s ease';
                         row.style.opacity = '1';
                         row.style.transform = 'translateY(0)';
                     }, index * 100);
                 });
             }
     
             // Función para mostrar estadísticas del producto seleccionado
             function showProductStats(productId) {
                 const row = document.querySelector(`[data-product-id="${productId}"]`);
                 if (!row) return;
     
                 const productName = row.querySelector('.product-name').textContent;
                 const productCategory = row.querySelector('.product-category').textContent;
                 const productPrice = row.querySelector('.product-price').textContent;
                 const productStock = row.querySelector('.stock-count').textContent;
     
                 console.log('📊 Producto seleccionado:', {
                     id: productId,
                     nombre: productName,
                     categoria: productCategory,
                     precio: productPrice,
                     stock: productStock
                 });
             }
     
             // Hacer funciones globales
             window.updateAllAdicionales = updateAllAdicionales;
             window.rebuildAllAdicionales = rebuildAllAdicionales;
             window.showProductStats = showProductStats;
             window.showProductAdicionales = showProductAdicionales;
     
             // Inicializar animaciones cuando la página esté lista
             setTimeout(() => {
                 animateTableRows();
             }, 100);
         </script>
     
         <!-- Estilos adicionales para el modal de adicionales -->
         <style>
             .adicionales-preview-modal .modal-content {
                 max-width: 700px;
             }
             
             .adicionales-preview-modal .modal-header {
                 background: linear-gradient(135deg, rgba(251, 181, 181, 0.2) 0%, rgba(18, 55, 42, 0.8) 100%);
             }
             
             .adicionales-preview-modal .modal-body {
                 max-height: 500px;
                 overflow-y: auto;
             }
     
             /* Mejorar el scroll en el modal */
             .adicionales-preview-modal .modal-body::-webkit-scrollbar {
                 width: 8px;
             }
             
             .adicionales-preview-modal .modal-body::-webkit-scrollbar-track {
                 background: rgba(255, 255, 255, 0.1);
                 border-radius: 4px;
             }
             
             .adicionales-preview-modal .modal-body::-webkit-scrollbar-thumb {
                 background: #fbb5b5;
                 border-radius: 4px;
             }
             
             .adicionales-preview-modal .modal-body::-webkit-scrollbar-thumb:hover {
                 background: #e8a3a3;
             }
     
             /* Efecto hover en las filas de la tabla */
             .table-row[data-product-id] {
                 cursor: pointer;
                 position: relative;
             }
     
             .table-row[data-product-id]::after {
                 content: '👆 Doble click para ver adicionales';
                 position: absolute;
                 bottom: -25px;
                 left: 50%;
                 transform: translateX(-50%);
                 background: rgba(251, 181, 181, 0.9);
                 color: #12372a;
                 padding: 4px 8px;
                 border-radius: 4px;
                 font-size: 0.7rem;
                 font-weight: 600;
                 opacity: 0;
                 transition: all 0.3s ease;
                 pointer-events: none;
                 white-space: nowrap;
                 z-index: 10;
             }
     
             .table-row[data-product-id]:hover::after {
                 opacity: 1;
                 bottom: -20px;
             }
     
             /* Responsive para el tooltip */
             @media (max-width: 768px) {
                 .table-row[data-product-id]::after {
                     display: none;
                 }
             }
     
             /* Estilo para botones de acción mejorados */
             .btn-action {
                 position: relative;
                 overflow: hidden;
             }
     
             .btn-action::before {
                 content: '';
                 position: absolute;
                 top: 50%;
                 left: 50%;
                 width: 0;
                 height: 0;
                 background: rgba(255, 255, 255, 0.3);
                 border-radius: 50%;
                 transition: all 0.3s ease;
                 transform: translate(-50%, -50%);
             }
     
             .btn-action:hover::before {
                 width: 100%;
                 height: 100%;
             }
     
             /* Indicadores de estado mejorados */
             .status {
                 position: relative;
                 overflow: hidden;
             }
     
             .status::before {
                 content: '';
                 position: absolute;
                 top: 0;
                 left: -100%;
                 width: 100%;
                 height: 100%;
                 background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
                 transition: left 0.6s ease;
             }
     
             .status:hover::before {
                 left: 100%;
             }
         </style>
     </body>
     </html>