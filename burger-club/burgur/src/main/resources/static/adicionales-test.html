<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Prueba CRUD Adicional</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin: 24px; background:#f7f7fb; }
    h1 { margin-top:0 }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .card { background:#fff; border:1px solid #e6e6ef; border-radius:12px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .row { display:flex; gap:12px; align-items:center; margin:8px 0; }
    label { width:120px; font-size:14px; color:#333; }
    input[type="text"], input[type="number"] { flex:1; padding:8px 10px; border:1px solid #d7d7e2; border-radius:8px; }
    input[type="checkbox"] { transform: scale(1.15); }
    button { cursor:pointer; border:0; border-radius:10px; padding:10px 14px; background:#111827; color:#fff; }
    button.secondary { background:#4b5563; }
    button.danger { background:#b91c1c; }
    .muted { color:#6b7280; font-size:12px; margin-top:-6px; }
    pre { background:#0b1020; color:#d1e7ff; padding:14px; border-radius:12px; overflow:auto; }
    .ok { color:#047857; font-weight:600; }
    .err { color:#b91c1c; font-weight:600; }
  </style>
</head>
<body>
  <h1>Tester CRUD – Adicional</h1>
  <p class="muted">Envía requests a <code>/adicionales</code>. El campo <b>categoría</b> se ingresa como lista separada por comas (ej: <i>hamburguesa, bebida</i>).</p>

  <div class="grid">
    <!-- CREAR -->
    <div class="card">
      <h3>Crear adicional (POST /adicionales/crear)</h3>
      <div class="row"><label>Nombre*</label><input id="c-nombre" type="text" placeholder="Queso extra" /></div>
      <div class="row"><label>Precio*</label><input id="c-precio" type="number" min="0" step="0.01" placeholder="2000" /></div>
      <div class="row"><label>Activo</label><input id="c-activo" type="checkbox" checked /></div>
      <div class="row"><label>Categorías</label><input id="c-categorias" type="text" placeholder="hamburguesa, acompañamiento" /></div>
      <div class="row"><button onclick="crear()">Crear</button></div>
      <p class="muted">Retorna 201 + JSON del adicional creado (con su <code>id</code>).</p>
    </div>

    <!-- ACTUALIZAR -->
    <div class="card">
      <h3>Actualizar adicional (PUT /adicionales/actualizar/{id})</h3>
      <div class="row"><label>ID*</label><input id="u-id" type="number" min="1" placeholder="1" /></div>
      <div class="row"><label>Nombre*</label><input id="u-nombre" type="text" placeholder="Queso extra" /></div>
      <div class="row"><label>Precio*</label><input id="u-precio" type="number" min="0" step="0.01" placeholder="2500" /></div>
      <div class="row"><label>Activo</label><input id="u-activo" type="checkbox" checked /></div>
      <div class="row"><label>Categorías</label><input id="u-categorias" type="text" placeholder="hamburguesa" /></div>
      <div class="row"><button class="secondary" onclick="actualizar()">Actualizar</button></div>
      <p class="muted">Envía el objeto completo requerido por tu <code>Service.save()</code> (nombre no vacío, etc.).</p>
    </div>

    <!-- BORRAR -->
    <div class="card">
      <h3>Borrar adicional (DELETE /adicionales/borrar/{id})</h3>
      <div class="row"><label>ID*</label><input id="d-id" type="number" min="1" placeholder="1" /></div>
      <div class="row"><button class="danger" onclick="borrar()">Borrar</button></div>
      <p class="muted">Debe responder 204 No Content.</p>
    </div>

    <!-- BUSCAR -->
    <div class="card">
      <h3>Buscar por ID (GET /adicionales/buscar?id=...)</h3>
      <div class="row"><label>ID*</label><input id="b-id" type="number" min="1" placeholder="1" /></div>
      <div class="row"><button class="secondary" onclick="buscar()">Buscar</button></div>

      <h3 style="margin-top:24px">Listar todos (GET /adicionales/buscar/todos)</h3>
      <div class="row"><button class="" onclick="listar()">Listar todos</button></div>
    </div>
  </div>

  <h3 style="margin-top:24px">Resultado</h3>
  <div id="status"></div>
  <pre id="out">(la respuesta aparecerá aquí)</pre>

  <script>
    const base = "/adicionales";

    function categoriasToArray(txt) {
      if (!txt) return [];
      return txt.split(",").map(s => s.trim()).filter(Boolean);
    }

    function setStatus(ok, msg) {
      const el = document.getElementById("status");
      el.innerHTML = ok ? `<span class="ok">✔ ${msg}</span>` : `<span class="err">✖ ${msg}</span>`;
    }

    function setOutput(data) {
      const el = document.getElementById("out");
      try {
        el.textContent = typeof data === "string" ? data : JSON.stringify(data, null, 2);
      } catch (e) {
        el.textContent = data;
      }
    }

    async function crear() {
      const nombre = document.getElementById("c-nombre").value.trim();
      const precio = parseFloat(document.getElementById("c-precio").value);
      const activo = document.getElementById("c-activo").checked;
      const categorias = categoriasToArray(document.getElementById("c-categorias").value);

      if (!nombre) return setStatus(false, "Nombre es obligatorio");
      if (isNaN(precio) || precio <= 0) return setStatus(false, "Precio inválido");

      const body = { nombre, precio, activo, categoria: categorias };

      try {
        const res = await fetch(`${base}/crear`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const text = await res.text();
        let payload = text;
        try { payload = JSON.parse(text); } catch (_) {}
        setStatus(res.ok, res.ok ? "Creado (201)" : `Error (${res.status})`);
        setOutput(payload);
      } catch (e) {
        setStatus(false, "Fallo de red");
        setOutput(String(e));
      }
    }

    async function actualizar() {
      const id = parseInt(document.getElementById("u-id").value);
      const nombre = document.getElementById("u-nombre").value.trim();
      const precio = parseFloat(document.getElementById("u-precio").value);
      const activo = document.getElementById("u-activo").checked;
      const categorias = categoriasToArray(document.getElementById("u-categorias").value);

      if (!id) return setStatus(false, "ID es obligatorio");
      if (!nombre) return setStatus(false, "Nombre es obligatorio");
      if (isNaN(precio) || precio <= 0) return setStatus(false, "Precio inválido");

      const body = { id, nombre, precio, activo, categoria: categorias };

      try {
        const res = await fetch(`${base}/actualizar/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const text = await res.text();
        let payload = text;
        try { payload = JSON.parse(text); } catch (_) {}
        setStatus(res.ok, res.ok ? "Actualizado (200)" : `Error (${res.status})`);
        setOutput(payload);
      } catch (e) {
        setStatus(false, "Fallo de red");
        setOutput(String(e));
      }
    }

    async function borrar() {
      const id = parseInt(document.getElementById("d-id").value);
      if (!id) return setStatus(false, "ID es obligatorio");

      try {
        const res = await fetch(`${base}/borrar/${id}`, { method: "DELETE" });
        if (res.status === 204) {
          setStatus(true, "Eliminado (204)");
          setOutput("No Content");
        } else {
          const text = await res.text();
          let payload = text;
          try { payload = JSON.parse(text); } catch (_) {}
          setStatus(false, `Error (${res.status})`);
          setOutput(payload);
        }
      } catch (e) {
        setStatus(false, "Fallo de red");
        setOutput(String(e));
      }
    }

    async function buscar() {
      const id = parseInt(document.getElementById("b-id").value);
      if (!id) return setStatus(false, "ID es obligatorio");

      try {
        const res = await fetch(`${base}/buscar?id=${encodeURIComponent(id)}`);
        const text = await res.text();
        let payload = text;
        try { payload = JSON.parse(text); } catch (_) {}
        setStatus(res.ok, res.ok ? "OK (200)" : `No encontrado (${res.status})`);
        setOutput(payload);
      } catch (e) {
        setStatus(false, "Fallo de red");
        setOutput(String(e));
      }
    }

    async function listar() {
      try {
        const res = await fetch(`${base}/buscar/todos`);
        const text = await res.text();
        let payload = text;
        try { payload = JSON.parse(text); } catch (_) {}
        setStatus(res.ok, res.ok ? "OK (200)" : `Error (${res.status})`);
        setOutput(payload);
      } catch (e) {
        setStatus(false, "Fallo de red");
        setOutput(String(e));
      }
    }
  </script>
</body>
</html>
