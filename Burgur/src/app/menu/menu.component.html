<!-- Loader -->
<div class="loader" id="loader" *ngIf="isLoading">
    <div class="loader-content">
        <div class="loader-logo">
            <img src="assets/images/Logo.png" alt="Burger Club">
        </div>
        <div class="loader-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
        <p>Cargando deliciosos sabores...</p>
    </div>
</div>

<!-- Header -->
<header class="site-header" id="header">
  <div class="container header-container">
    <a routerLink="/" class="logo">
      <div class="logo-icon-wrapper">
        <img src="assets/images/Logo.png" alt="Burger Club Logo" class="logo-icon">
      </div>
      <span class="logo-text">BURGER CLUB</span>
    </a>
    <nav class="main-nav" id="mainNav">
      <ul>
        <li><a routerLink="/" class="nav-link">Inicio</a></li>
        <li><a routerLink="/menu" class="nav-link active">Men√∫</a></li>
        <li><a routerLink="/auth/login" class="nav-link auth-link" id="loginLink" *ngIf="!isAuthenticated">Iniciar Sesi√≥n</a></li>
        <li><a routerLink="/auth/register" class="nav-link auth-link" id="registerLink" *ngIf="!isAuthenticated">Registrarse</a></li>
        <li><a routerLink="/user/profile" class="nav-link" *ngIf="isAuthenticated">Mi Perfil</a></li>
        <li>
          <a href="#" class="cart-link" id="cartBtn" (click)="toggleCart()">
            <i class="fas fa-shopping-cart"></i>
            <span>Carrito</span>
            <span class="cart-count" id="cartCount">{{ cartItemsCount }}</span>
          </a>
        </li>
      </ul>
    </nav>
    <div class="location-info" id="locationBtn">
      <i class="fas fa-map-marker-alt"></i>
      <span>Encu√©ntranos ac√°</span>
    </div>
    <button class="mobile-nav-toggle" id="mobileNavToggle" 
            (click)="toggleMobileMenu()" 
            [attr.aria-expanded]="isMobileMenuOpen">
      <span class="hamburger-icon"></span>
    </button>
  </div>
</header>

<!-- Mobile Menu -->
<nav class="mobile-menu" id="mobileMenu" [class.active]="isMobileMenuOpen">
  <ul>
    <li><a routerLink="/" class="mobile-nav-link" (click)="closeMobileMenu()">Inicio</a></li>
    <li><a routerLink="/menu" class="mobile-nav-link" (click)="closeMobileMenu()">Men√∫</a></li>
    <li><a routerLink="/auth/login" class="mobile-nav-link mobile-auth-link" *ngIf="!isAuthenticated" (click)="closeMobileMenu()">Iniciar Sesi√≥n</a></li>
    <li><a routerLink="/auth/register" class="mobile-nav-link mobile-auth-link" *ngIf="!isAuthenticated" (click)="closeMobileMenu()">Registrarse</a></li>
    <li><a routerLink="/user/profile" class="mobile-nav-link" *ngIf="isAuthenticated" (click)="closeMobileMenu()">Mi Perfil</a></li>
    <li><a href="#" class="mobile-nav-link" id="mobileCartLink" (click)="toggleCart(); closeMobileMenu()">Carrito</a></li>
    <li><a href="#" class="mobile-nav-link" id="mobileLocationLink" (click)="closeMobileMenu()">Ubicaci√≥n</a></li>
  </ul>
</nav>
<div class="mobile-menu-overlay" id="mobileMenuOverlay" 
     [class.active]="isMobileMenuOpen" 
     (click)="closeMobileMenu()"></div>

<!-- Menu Section -->
<main id="menu" class="menu-section">
    <div class="page-wrapper">
        <!-- Background Decorations -->
        <div class="background-decorations">
            <div class="deco-item deco-1">üçî</div>
            <div class="deco-item deco-2">üçü</div>
            <div class="deco-item deco-3">ü•§</div>
            <div class="deco-item deco-4">üç∞</div>
            <div class="deco-item deco-5">‚ú®</div>
            <div class="deco-item deco-6">üí´</div>
        </div>

        <div class="container">
            <div class="menu-header">
                <h1 class="menu-title">NUESTRO MEN√ö</h1>
                <p class="menu-subtitle">Descubre nuestros sabores √∫nicos</p>
            </div>

            <!-- Barra de b√∫squeda -->
            <div class="menu-search-container">
                <form class="menu-search-form" role="search" aria-label="Buscar productos" (submit)="$event.preventDefault()">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon" aria-hidden="true"></i>
                        <input
                            type="text"
                            name="nombre"
                            class="menu-search-input"
                            placeholder="Buscar productos..."
                            [(ngModel)]="searchTerm"
                            (input)="onSearchChange()"
                            autocomplete="off" />
                        <button class="search-submit" type="submit" aria-label="Buscar" style="display: none;">Buscar</button>
                        <!-- Bot√≥n limpiar b√∫squeda -->
                        <a class="search-clear" *ngIf="searchTerm" (click)="clearSearch()" aria-label="Limpiar b√∫squeda">
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </a>
                    </div>
                </form>
            </div>

            <!-- Filtros de categor√≠a -->
            <div class="menu-filters">
                <!-- Todos -->
                <a class="filter-btn" 
                   [class.active]="selectedCategory === 'all'"
                   (click)="filterByCategory('all')">
                    <i class="fas fa-th"></i><span>Todos</span>
                </a>

                <!-- Hamburguesas -->
                <a class="filter-btn"
                   [class.active]="selectedCategory === 'hamburguesa'"
                   (click)="filterByCategory('hamburguesa')">
                    <i class="fas fa-hamburger"></i><span>Hamburguesas</span>
                </a>

                <!-- Acompa√±amientos -->
                <a class="filter-btn"
                   [class.active]="selectedCategory === 'acompa√±amiento'"
                   (click)="filterByCategory('acompa√±amiento')">
                    <i class="fas fa-utensils"></i><span>Acompa√±amientos</span>
                </a>

                <!-- Perros Calientes -->
                <a class="filter-btn"
                   [class.active]="selectedCategory === 'perro caliente'"
                   (click)="filterByCategory('perro caliente')">
                    <i class="fas fa-hotdog"></i><span>Perros</span>
                </a>

                <!-- Bebidas -->
                <a class="filter-btn"
                   [class.active]="selectedCategory === 'bebida'"
                   (click)="filterByCategory('bebida')">
                    <i class="fas fa-glass-whiskey"></i><span>Bebidas</span>
                </a>

                <!-- Postres -->
                <a class="filter-btn"
                   [class.active]="selectedCategory === 'postre'"
                   (click)="filterByCategory('postre')">
                    <i class="fas fa-ice-cream"></i><span>Postres</span>
                </a>
            </div>
                    
            <!-- Info de resultados de b√∫squeda -->
            <div *ngIf="searchTerm" class="search-results-info">
                <p>
                    <i class="fas fa-search"></i>
                    Mostrando <strong>{{filteredProducts.length}}</strong>
                    resultado{{filteredProducts.length === 1 ? '' : 's'}}
                    para "<strong>{{searchTerm}}</strong>"
                    ¬∑ <a (click)="clearSearch()" class="link-button">Limpiar b√∫squeda</a>
                </p>
            </div>

            <!-- Info de resultados de categor√≠a -->
            <div *ngIf="selectedCategory !== 'all'" class="search-results-info">
                <p>
                    <i class="fas fa-filter"></i>
                    Mostrando <strong>{{filteredProducts.length}}</strong>
                    producto{{filteredProducts.length === 1 ? '' : 's'}}
                    en la categor√≠a "<strong>{{getCategoryDisplayName(selectedCategory)}}</strong>"
                    ¬∑ <a (click)="filterByCategory('all')" class="link-button">Ver todos</a>
                </p>
            </div>

            <!-- Menu Grid -->
            <div class="menu-grid" id="menuGrid">
                <!-- Mensaje si no hay productos -->
                <div *ngIf="filteredProducts.length === 0" class="empty-state" style="grid-column: 1 / -1;">
                    <i class="fas fa-search"></i>
                    <h3>No se encontraron productos</h3>
                    
                    <p *ngIf="searchTerm">No hay productos que coincidan con "<strong>{{searchTerm}}</strong>".</p>
                    
                    <p *ngIf="selectedCategory !== 'all' && !searchTerm">No hay productos en la categor√≠a "<strong>{{getCategoryDisplayName(selectedCategory)}}</strong>".</p>
                    
                    <p *ngIf="!searchTerm && selectedCategory === 'all'">Actualmente no hay productos disponibles.</p>
                    
                    <button (click)="clearFilters()" class="btn-load-more" style="display: inline-flex;">
                        <span>Ver todos los productos</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <!-- Loop de productos -->
                <article *ngFor="let product of filteredProducts; trackBy: trackByProductId" 
                         class="menu-card"
                         [attr.data-id]="product.id"
                         [attr.data-category]="product.categoria.toLowerCase()"
                         [attr.data-price]="product.precio"
                         [attr.data-name]="product.nombre"
                         [attr.data-image]="product.imgURL"
                         [attr.data-desc]="product.descripcion"
                         role="article" 
                         tabindex="0"
                         title="Producto disponible">
                    
                    <!-- Badge de producto nuevo -->
                    <div *ngIf="product.nuevo" class="menu-card-badge">Nuevo</div>
                    
                    <!-- Badge de producto popular -->
                    <div *ngIf="product.popular && !product.nuevo" class="menu-card-badge popular">Popular</div>

                    <div class="menu-card-image">
                        <img [src]="product.imgURL" 
                             [alt]="product.nombre" 
                             class="menu-card-img"
                             (error)="onImageError($event)">
                        
                        <!-- Overlay con informaci√≥n adicional -->
                        <div class="card-overlay">
                            <div class="overlay-content">
                                <p class="overlay-text">Ver detalles y adicionales</p>
                                <i class="fas fa-eye overlay-icon"></i>
                            </div>
                        </div>
                    </div>

                    <div class="menu-card-content">
                        <h3 class="menu-card-name">{{product.nombre}}</h3>
                        <p class="menu-card-description">{{product.descripcion}}</p>
                        
                        <!-- Mostrar ingredientes simplificado -->
                        <div *ngIf="product.ingredientes && product.ingredientes.length > 0" class="menu-card-ingredients">
                            <small class="ingredients-label">Ingredientes:</small>
                            <small class="ingredients-text">
                                <!-- Mostrar solo los primeros 3 ingredientes -->
                                <span *ngFor="let ing of product.ingredientes.slice(0, 3); let i = index">
                                    {{ing}}<span *ngIf="i < 2 && i < product.ingredientes.length - 1">, </span>
                                </span>
                                <span *ngIf="product.ingredientes.length > 3">...</span>
                            </small>
                        </div>
                        
                        <div class="menu-card-footer">
                            <span class="menu-card-price">${{formatPrice(product.precio)}}</span>
                            <button class="btn-add-cart add-to-cart-btn"
                                    (click)="openProductDetail(product)"
                                    [attr.data-id]="product.id"
                                    [attr.data-name]="product.nombre"
                                    [attr.data-price]="product.precio"
                                    [attr.data-image]="product.imgURL"
                                    [title]="'Ver detalles de ' + product.nombre">
                                <i class="fas fa-plus"></i>
                                Ver Detalles
                            </button>
                        </div>
                    </div>
                </article>
            </div>

            <!-- Informaci√≥n adicional -->
            <div *ngIf="filteredProducts.length > 0" class="menu-info">
                <div class="products-count">
                    <p>
                        <i class="fas fa-utensils"></i>
                        Mostrando <strong>{{filteredProducts.length}}</strong> 
                        producto{{filteredProducts.length === 1 ? '' : 's'}}
                        <span *ngIf="selectedCategory !== 'all'">
                            en <strong>{{getCategoryDisplayName(selectedCategory)}}</strong>
                        </span>
                    </p>
                </div>
                
                <!-- Call to action para usuarios no autenticados -->
                <div class="auth-cta" id="authCta" style="display: none;">
                    <div class="cta-content">
                        <h3>¬°√önete a Burger Club!</h3>
                        <p>Crea tu cuenta para disfrutar de ofertas exclusivas y un mejor servicio</p>
                        <div class="cta-buttons">
                            <a routerLink="/auth/register" class="btn-cta primary">Registrarse</a>
                            <a routerLink="/auth/login" class="btn-cta secondary">Iniciar Sesi√≥n</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Cart Modal -->
<div class="cart-modal" id="cartModal" [class.active]="showCart">
    <div class="cart-modal-content">
        <div class="cart-modal-header">
            <h2>Tu Carrito</h2>
            <button class="cart-close" (click)="toggleCart()">&times;</button>
        </div>
        <div class="cart-modal-body" id="cartItems">
            <div *ngIf="cartItems.length === 0" class="empty-cart">
                <p>Tu carrito est√° vac√≠o</p>
            </div>
            <div *ngFor="let item of cartItems" class="cart-item">
                <div class="cart-item-image">
                    <img [src]="item.image" [alt]="item.name">
                </div>
                <div class="cart-item-details">
                    <h4 class="cart-item-name">{{item.name}}</h4>
                    <p class="cart-item-price">${{formatPrice(item.price)}}</p>
                    <div *ngIf="item.adicionales && item.adicionales.length > 0" class="cart-item-extras">
                        <span *ngFor="let adicional of item.adicionales; let i = index">
                            +{{adicional.nombre}}<span *ngIf="i < item.adicionales.length - 1">, </span>
                        </span>
                    </div>
                </div>
                <div class="cart-item-controls">
                    <button class="quantity-btn" (click)="decreaseQuantity(item.id)" [disabled]="item.quantity <= 1">-</button>
                    <span class="quantity-display">{{item.quantity}}</span>
                    <button class="quantity-btn" (click)="increaseQuantity(item.id)">+</button>
                    <button class="remove-item-btn" (click)="removeFromCart(item.id)" title="Eliminar producto">√ó</button>
                </div>
            </div>
        </div>
        <div class="cart-modal-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">${{formatPrice(cartTotal)}}</span>
            </div>
            <button class="btn-checkout" [disabled]="cartItems.length === 0" (click)="checkout()">Proceder al Pago</button>
        </div>
    </div>
</div>

<!-- Product Modal -->
<app-product-modal 
  *ngIf="showModal && selectedProduct"
  [product]="selectedProduct"
  [adicionales]="selectedProductAdicionales"
  [isVisible]="showModal"
  (close)="closeProductModal()">
</app-product-modal>

<app-footer></app-footer>